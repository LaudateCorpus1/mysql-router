{
  "title": "MySQL Server Mock Data",
  "description": "JSON Schema of the input files of the mysql-server-mock",
  "$schema": "http://json-schema.org/draft-04/schema#",

  "type": "object",
  "additionalProperties": false,

  "definitions": {
    "Ok": {
      "description": "OK response",
      "type": "null"
    },

    "Error": {
      "description": "Error response",
      "type": "object",
      "additionalProperties": false
    },

    "ResultsetColumn": {
      "description": "column description",
      "type": "object",
      "additionalProperties": false,

      "properties": {
        "type": {
          "description": "datatype of the column",
          "enum": [
            "STRING",
            "LONGLONG"
          ]
        },
        "name": {
          "description": "name of the column",
          "type": "string"
        },
        "comment": {
          "description": "additional information/comment about the column; ignored by the server mock, for self-documenting only",
          "type": "string"
        },
        "repeat": {
          "description": "if set to positive number n, the data for given field will be duplicated n times; useful for generating big packets; supported only for columns with type STRING",
          "type": "string"
        }
      }
    },

    "ResultsetRow": {
      "description": "resultset row",
      "type": "array",
      "minItems": 1,
      "items": {
        "title": "ResultsetField",
        "description": "field of a resultset row",
        "type": [ "number", "string", "boolean", "null" ]
      }
    },

    "Result": {
      "description": "resultset for a statement",
      "type": "object",
      "additionalProperties": false,

      "properties": {
        "columns": {
          "description": "column descriptions",
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/ResultsetColumn"
          }
        },
        "rows": {
          "description": "resultset rows",
          "type": "array",
          "items": {
            "$ref": "#/definitions/ResultsetRow"
          }
        }
      },
      "required": ["columns"]
    },

    "RPC": {
      "description": "statement and its response",
      "type": "object",
      "additionalProperties": false,

      "properties": {
        "stmt": {
          "description": "statement text",
          "type": "string"
        },
        "stmt.regex": {
          "description": "regular expression matching the statement text",
          "type": "string"
        },
        "result": {
          "$ref": "#/definitions/Result"
        },
        "ok": {
          "$ref": "#/definitions/Ok"
        },
        "error": {
          "$ref": "#/definitions/Error"
        }
      },
      "allOf": [
        {
          "oneOf": [
            {
              "required": ["stmt"]
            },
            {
              "required": ["stmt.regex"]
            }
          ]
        },
        {
          "oneOf": [
            {
              "required": ["ok"]
            },
            {
              "required": ["result"]
            },
            {
              "required": ["error"]
            }
          ]
        }
      ]
    }
  },

  "properties": {
    "stmts": {
      "description": "RPCs that the mock will expect and process one after the other",
      "type": "array",
      "items": {
        "$ref": "#/definitions/RPC"
      }
    }
  },
  "required": ["stmts"]
}
